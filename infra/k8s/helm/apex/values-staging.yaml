# ══════════════════════════════════════════════════════════════════════════════
# Project Apex - Staging Environment Values
# ══════════════════════════════════════════════════════════════════════════════

# Global settings
global:
  environment: staging

# ──────────────────────────────────────────────────────────────────────────────
# API Server - Staging
# ──────────────────────────────────────────────────────────────────────────────
api:
  replicaCount: 2

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"
      cert-manager.io/cluster-issuer: "letsencrypt-staging"
    hosts:
      - host: api.staging.apex.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: api-staging-tls
        hosts:
          - api.staging.apex.example.com

  env:
    RUST_LOG: "info,apex_core=debug"
    ENVIRONMENT: "staging"

# ──────────────────────────────────────────────────────────────────────────────
# Worker Pool - Staging
# ──────────────────────────────────────────────────────────────────────────────
worker:
  replicaCount: 2
  workersPerPod: 1
  agentsPerWorker: 3

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10

# ──────────────────────────────────────────────────────────────────────────────
# Dashboard - Staging
# ──────────────────────────────────────────────────────────────────────────────
dashboard:
  replicaCount: 1

  resources:
    requests:
      memory: "32Mi"
      cpu: "25m"
    limits:
      memory: "128Mi"
      cpu: "100m"

  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-staging"
    hosts:
      - host: staging.apex.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: dashboard-staging-tls
        hosts:
          - staging.apex.example.com

# ──────────────────────────────────────────────────────────────────────────────
# PostgreSQL - Staging
# ──────────────────────────────────────────────────────────────────────────────
postgresql:
  enabled: true
  primary:
    persistence:
      size: 5Gi
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# ──────────────────────────────────────────────────────────────────────────────
# Redis - Staging
# ──────────────────────────────────────────────────────────────────────────────
redis:
  enabled: true
  master:
    persistence:
      size: 512Mi
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "250m"

# ──────────────────────────────────────────────────────────────────────────────
# Monitoring - Staging
# ──────────────────────────────────────────────────────────────────────────────
monitoring:
  serviceMonitor:
    enabled: true
    interval: 30s

  prometheusRule:
    enabled: true

# ──────────────────────────────────────────────────────────────────────────────
# Configuration - Staging
# ──────────────────────────────────────────────────────────────────────────────
config:
  orchestrator:
    maxConcurrentAgents: "50"
    defaultTokenLimit: "10000"
    defaultCostLimit: "0.10"
    defaultTimeLimitSeconds: "180"

  routing:
    # Use cheaper models for staging
    economyModel: "gpt-4o-mini"
    standardModel: "gpt-4o-mini"
    premiumModel: "gpt-4o"
    confidenceThreshold: "0.80"

  logging:
    level: "debug,apex_core=trace"
